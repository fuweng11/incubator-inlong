#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#

#
# Attention:
# in this example, use dataproxy.conf as file name,
# In addition, if you want to keep the order of messages,
# in addition configuring the properties to order when sending,
# you must configure separate channels and sinks for sequential messages,
# and config order property in source module in dataproxy.
#

agent1.sources = tcp-source http-source
agent1.channels = ch-msg1 ch-order ch-msg5 ch-index-msg1 ch-index-msg2 pulsar-xfe-msg1 pulsar-xfe-msg2
agent1.sinks = mq-sink-msg1 mq-sink-order mq-sink-msg5 index-controller-sink1 index-remote-sink2 pulsar-xfer-sink1 pulsar-xfer-sink2

# tcp-source
agent1.sources.tcp-source.channels = ch-msg1 ch-order ch-msg5 ch-file-index-msg1 ch-file-index-msg2 pulsar-xfe-msg1 pulsar-xfe-msg2
agent1.sources.tcp-source.type = org.apache.inlong.dataproxy.source.SimpleTcpSource
agent1.sources.tcp-source.msg-factory-name = org.apache.inlong.dataproxy.source.ServerMessageFactory
# replace it with the ip you specified
agent1.sources.tcp-source.host = localhost
agent1.sources.tcp-source.port = 46801
agent1.sources.tcp-source.max-msg-length = 524288
agent1.sources.tcp-source.connections = 30000
agent1.sources.tcp-source.receiveBufferSize = 65536
agent1.sources.tcp-source.sendBufferSize = 65536
agent1.sources.tcp-source.msg-compressed = true
agent1.sources.tcp-source.max-threads = 64
agent1.sources.tcp-source.custom-cp = true
agent1.sources.tcp-source.selector.type = org.apache.inlong.dataproxy.channel.FailoverChannelSelector
agent1.sources.tcp-source.selector.master = ch-msg1
# order message channels, optional
agent1.sources.tcp-source.selector.order = ch-msg3
# file index message channels, only TCP source, optional
agent1.sources.tcp-source.selector.fileMetricMaster = ch-file-index-msg1
agent1.sources.tcp-source.selector.fileMetricSlave = ch-file-index-msg2
# pulsar transfer channels, optional
agent1.sources.tcp-source.selector.pulsarXfeMaster = pulsar-xfe-msg1
agent1.sources.tcp-source.selector.pulsarXfeSlave = pulsar-xfe-msg2
# optional parameter, enable if needed
#agent1.sources.tcp-source.filter-empty-msg = false
#agent1.sources.tcp-source.max-accept-threads = 1
#agent1.sources.tcp-source.con-backlog = 128
#agent1.sources.tcp-source.reuse-address = true
#agent1.sources.tcp-source.tcpNoDelay = true
#agent1.sources.tcp-source.keepAlive = true
#agent1.sources.tcp-source.enableBusyWait = false
#agent1.sources.tcp-source.highWaterMark = 65536
#agent1.sources.tcp-source.maxReadIdleTime = 60000

# http-source
agent1.sources.http-source.channels = ch-msg1 ch-msg5
agent1.sources.http-source.type = org.apache.inlong.dataproxy.source.SimpleHttpSource
agent1.sources.http-source.msg-factory-name = org.apache.inlong.dataproxy.source.httpMsg.HttpMessageHandler
# replace it with the ip you specified
agent1.sources.http-source.host = localhost
agent1.sources.http-source.port = 46802
agent1.sources.http-source.max-msg-length = 524288
agent1.sources.http-source.connections = 30000
agent1.sources.http-source.receiveBufferSize = 65536
agent1.sources.http-source.sendBufferSize = 65536
agent1.sources.http-source.msg-compressed = true
agent1.sources.http-source.max-threads = 64
agent1.sources.http-source.custom-cp = true
agent1.sources.http-source.selector.type = org.apache.inlong.dataproxy.channel.FailoverChannelSelector
agent1.sources.http-source.selector.master = ch-msg1
#agent1.sources.tcp-source.filter-empty-msg = false
#agent1.sources.tcp-source.max-accept-threads = 1
#agent1.sources.tcp-source.con-backlog = 128
#agent1.sources.tcp-source.reuse-address = true
#agent1.sources.tcp-source.tcpNoDelay = true
#agent1.sources.tcp-source.keepAlive = true
#agent1.sources.tcp-source.enableBusyWait = false
#agent1.sources.tcp-source.highWaterMark = 65536
#agent1.sources.tcp-source.maxReadIdleTime = 60000

# channels
agent1.channels.ch-msg1.type = memory
agent1.channels.ch-msg1.capacity = 50000
agent1.channels.ch-msg1.keep-alive = 0
agent1.channels.ch-msg1.transactionCapacity = 200

agent1.channels.ch-msg5.type = file
agent1.channels.ch-msg5.capacity = 100000000
agent1.channels.ch-msg5.maxFileSize = 1073741824
agent1.channels.ch-msg5.minimumRequiredSpace = 1073741824
agent1.channels.ch-msg5.checkpointDir = ./data/file/ch-msg5/check
agent1.channels.ch-msg5.dataDirs = ./data/file/ch-msg5/data
agent1.channels.ch-msg5.fsyncPerTransaction = false
agent1.channels.ch-msg5.fsyncInterval = 10

# TubeMQ sink
agent1.sinks.mq-sink-msg1.channel = ch-msg1
agent1.sinks.mq-sink-msg1.type = org.apache.inlong.dataproxy.sink2.TubeMQSink
agent1.sinks.mq-sink-msg1.master-server-url-list = 127.0.0.1:8609,127.0.0.1:8609
agent1.sinks.mq-sink-msg1.max-threads = 8
# cache settings
#agent1.sinks.mq-sink-msg1.enableMsgCacheDedup = true
#agent1.sinks.mq-sink-msg1.max-cache-concurrent-access = 32
# unit seconds
#agent1.sinks.mq-sink-msg1.max-cache-survived-time = 30
#agent1.sinks.mq-sink-msg1.max-cache-survived-size = 5000000
# default value: common.properties maxBufferQueueSizeKb 131072 (128 * 1024 KB)
#agent1.sinks.mq-sink-msg1.max-inflight-buffer-size-KB = 131072
#agent1.sinks.mq-sink-msg1.client-connect-timeout-ms = 30000
#agent1.sinks.mq-sink-msg1.client-request-timeout-ms = 20000
#agent1.sinks.mq-sink-msg1.max-send-failure-wait-dur-ms = 100
#agent1.sinks.mq-sink-msg1.link-max-allowed-delayed-msg-count = 80000
#agent1.sinks.mq-sink-msg1.session-warn-delayed-msg-count = 2000000
#agent1.sinks.mq-sink-msg1.session-max-allowed-delayed-msg-count = 4000000
# 15 * 1024 * 1024
#agent1.sinks.mq-sink-msg1.netty-write-buffer-high-water-mark = 15728640
#agent1.sinks.mq-sink-msg1.max-topic-each-producer-hold = 200
#agent1.sinks.mq-sink-msg1.send-worker-status-check-msg-cnt = 2000
#agent1.sinks.mq-sink-msg1.send-worker-thrown-check-cnt = 100
#agent1.sinks.mq-sink-msg1.send-worker-slow-sleep-ms = 100

# PulsarSink
agent1.sinks.pulsar-xfer-sink1.channel = pulsar-xfer-sink1
agent1.sinks.pulsar-xfer-sink1.type = org.apache.inlong.dataproxy.sink2.PulsarSink
agent1.sinks.pulsar-xfer-sink1.master-server-url-list = pulsar://127.0.0.1:6650,127.0.0.2:6650
agent1.sinks.mq-sink-msg1.max-pulsar-io-threads = 8
agent1.sinks.pulsar-xfer-sink1.max-threads = 1
#agent1.sinks.mq-sink-msg1.enableMsgCacheDedup = true
#agent1.sinks.mq-sink-msg1.max-cache-concurrent-access = 32
# Unit seconds
#agent1.sinks.mq-sink-msg1.max-cache-survived-time = 30
#agent1.sinks.mq-sink-msg1.max-cache-survived-size = 5000000
# default value: common.properties maxBufferQueueSizeKb 131072 (128 * 1024 KB)
#agent1.sinks.mq-sink-msg1.max-inflight-buffer-size-KB = 131072
#agent1.sinks.mq-sink-msg1.client-connect-timeout-ms = 30000
#agent1.sinks.mq-sink-msg1.client-request-timeout-ms = 20000
#agent1.sinks.mq-sink-msg1.max-send-failure-wait-dur-ms = 100
#agent1.sinks.mq-sink-msg1.client-stats-output-intvl-sec = 300
#agent1.sinks.mq-sink-msg1.max-broker-abnormal-quarantine-sec = 300
#agent1.sinks.mq-sink-msg1.enable-batch = true
#agent1.sinks.mq-sink-msg1.block-if-queue-full = true
#agent1.sinks.mq-sink-msg1.max-pending-messages = 10000
#agent1.sinks.mq-sink-msg1.max-batching-messages = 1000



# agent index message controller, store to controller or local log
agent1.sinks.index-controller-sink1.channel = ch-index-msg1
agent1.sinks.index-controller-sink1.type = org.apache.inlong.dataproxy.sink2.ControllerSink
agent1.sinks.index-controller-sink1.send-remote = false
agent1.sinks.index-controller-sink1.controller-config-file =
# only single thread to send
#agent1.sinks.index-controller-sink1.max-threads = 1
#agent1.sinks.index-controller-sink1.enableMsgCacheDedup = true
#agent1.sinks.index-controller-sink1.max-cache-concurrent-access = 32
# unit seconds
#agent1.sinks.index-controller-sink1.max-cache-survived-time = 30
#agent1.sinks.index-controller-sink1.max-cache-survived-size = 5000000
# default value: common.properties maxBufferQueueSizeKb 131072 (128 * 1024 KB)
#agent1.sinks.mq-sink-msg1.max-inflight-buffer-size-KB = 131072
# defalut value : common.properties max.retries.after.failure, -1
#agent1.sinks.index-controller-sink1.max-retry-cnt = -1



# controller-sink-msg2, send data to remote tube mq
agent1.sinks.index-remote-sink2.channel = ch-index-msg2
agent1.sinks.index-remote-sink2.type = org.apache.inlong.dataproxy.sink2.ControllerSink
agent1.sinks.index-remote-sink2.send-remote = true
agent1.sinks.index-remote-sink2.master-server-url-list = 127.0.0.1:8609,127.0.0.1:8609
agent1.sinks.index-remote-sink2.max-threads = 10
agent1.sinks.index-remote-sink2.agent-index-topic = teg_tdbank
agent1.sinks.index-remote-sink2.agent-index-status-tid = agent_file_status_log
agent1.sinks.index-remote-sink2.agent-index-measure-tid = agent_measure_log
#agent1.sinks.index-remote-sink2.enableMsgCacheDedup = true
#agent1.sinks.index-remote-sink2.max-cache-concurrent-access = 32
# unit seconds
#agent1.sinks.index-remote-sink2.max-cache-survived-time = 30
#agent1.sinks.index-remote-sink2.max-cache-survived-size = 5000000
# default value: common.properties maxBufferQueueSizeKb 131072 (128 * 1024 KB)
#agent1.sinks.mq-sink-msg1.max-inflight-buffer-size-KB = 131072
#agent1.sinks.index-remote-sink2.client-connect-timeout-ms = 330000
#agent1.sinks.index-remote-sink2.client-request-timeout-ms = 20000
#agent1.sinks.index-remote-sink2.max-send-failure-wait-dur-ms = 100
# tube client settings
#agent1.sinks.index-remote-sink2.link-max-allowed-delayed-msg-count = 80000
#agent1.sinks.index-remote-sink2.session-warn-delayed-msg-count = 2000000
#agent1.sinks.index-remote-sink2.session-max-allowed-delayed-msg-count = 4000000
# 15 * 1024 * 1024
#agent1.sinks.index-remote-sink2.netty-write-buffer-high-water-mark = 15728640
# defalut value : common.properties max.retries.after.failure, -1
#agent1.sinks.index-remote-sink2.max-retry-cnt = -1



